# Git Tools Catalog
# Comprehensive catalog of all git operation tools

category: "git"
description: "Tools for git version control operations"

tools:
  # Git Status
  - name: "git_status"
    description: "Check git repository status"
    parameters: []
    returns:
      type: "object"
      properties:
        branch:
          type: "string"
          description: "Current branch name"
        modified:
          type: "array"
          description: "Modified files"
        untracked:
          type: "array"
          description: "Untracked files"
        staged:
          type: "array"
          description: "Staged files"
        clean:
          type: "boolean"
          description: "Working directory clean"
    errors:
      - code: "E_NOT_A_REPO"
        description: "Not a git repository"
    example:
      output:
        branch: "main"
        modified: ["src/main.rs"]
        untracked: ["test.txt"]
        staged: []
        clean: false

  # Git Diff
  - name: "git_diff"
    description: "Show changes between commits or working tree"
    parameters:
      - name: "rev"
        type: "string"
        required: false
        default: "HEAD"
        description: "Revision to compare against"
      - name: "paths"
        type: "array"
        required: false
        description: "Specific paths to diff"
      - name: "staged"
        type: "boolean"
        required: false
        default: false
        description: "Show staged changes only"
    returns:
      type: "object"
      properties:
        diff:
          type: "string"
          description: "Unified diff output"
        files_changed:
          type: "integer"
        insertions:
          type: "integer"
        deletions:
          type: "integer"
    errors:
      - code: "E_INVALID_REV"
      - code: "E_NOT_A_REPO"
    example:
      input: { rev: "HEAD", staged: false }
      output:
        diff: "--- a/src/main.rs\n+++ b/src/main.rs\n..."
        files_changed: 1
        insertions: 5
        deletions: 2

  # Git Add
  - name: "git_add"
    description: "Stage changes for commit"
    parameters:
      - name: "paths"
        type: "array"
        required: true
        description: "Paths to stage (use ['.'] for all)"
      - name: "force"
        type: "boolean"
        required: false
        default: false
        description: "Add ignored files"
    returns:
      type: "object"
      properties:
        staged_files:
          type: "array"
        count:
          type: "integer"
    errors:
      - code: "E_FILE_NOT_FOUND"
      - code: "E_NOT_A_REPO"
    example:
      input: { paths: ["src/main.rs", "Cargo.toml"] }
      output: { staged_files: ["src/main.rs", "Cargo.toml"], count: 2 }

  # Git Commit
  - name: "git_commit"
    description: "Commit staged changes"
    parameters:
      - name: "message"
        type: "string"
        required: true
        description: "Commit message"
      - name: "signoff"
        type: "boolean"
        required: false
        default: false
        description: "Add Signed-off-by line"
      - name: "amend"
        type: "boolean"
        required: false
        default: false
        description: "Amend previous commit"
    returns:
      type: "object"
      properties:
        commit_sha:
          type: "string"
        message:
          type: "string"
        files_changed:
          type: "integer"
    errors:
      - code: "E_NOTHING_TO_COMMIT"
      - code: "E_COMMIT_FAILED"
    example:
      input: { message: "fix: resolve login bug", signoff: true }
      output: { commit_sha: "abc1234", message: "fix: resolve login bug", files_changed: 2 }

  # Git Checkout
  - name: "git_checkout"
    description: "Switch branches or restore files"
    parameters:
      - name: "target"
        type: "string"
        required: true
        description: "Branch name or commit"
      - name: "create"
        type: "boolean"
        required: false
        default: false
        description: "Create new branch"
      - name: "force"
        type: "boolean"
        required: false
        default: false
        description: "Force checkout (discard changes)"
    returns:
      type: "object"
      properties:
        branch:
          type: "string"
        created:
          type: "boolean"
    errors:
      - code: "E_BRANCH_NOT_FOUND"
      - code: "E_UNCOMMITTED_CHANGES"
      - code: "E_BRANCH_EXISTS"
    example:
      input: { target: "feature/new-api", create: true }
      output: { branch: "feature/new-api", created: true }

  # Git Log
  - name: "git_log"
    description: "Show commit history"
    parameters:
      - name: "max_count"
        type: "integer"
        required: false
        default: 10
        description: "Maximum commits to show"
      - name: "since"
        type: "string"
        required: false
        description: "Show commits after date"
      - name: "author"
        type: "string"
        required: false
        description: "Filter by author"
    returns:
      type: "object"
      properties:
        commits:
          type: "array"
          items:
            type: "object"
            properties:
              sha:
                type: "string"
              message:
                type: "string"
              author:
                type: "string"
              date:
                type: "string"
        count:
          type: "integer"
    errors:
      - code: "E_NOT_A_REPO"
    example:
      input: { max_count: 5 }
      output:
        commits:
          - { sha: "abc123", message: "feat: add feature", author: "user", date: "2025-01-15" }
        count: 1

  # Git Branch
  - name: "git_branch"
    description: "List, create, or delete branches"
    parameters:
      - name: "action"
        type: "string"
        required: false
        default: "list"
        description: "Action: list, create, delete"
      - name: "name"
        type: "string"
        required: false
        description: "Branch name (for create/delete)"
    returns:
      type: "object"
      properties:
        branches:
          type: "array"
        current:
          type: "string"
    errors:
      - code: "E_BRANCH_NOT_FOUND"
      - code: "E_BRANCH_EXISTS"

  # Git Reset
  - name: "git_reset"
    description: "Unstage or reset changes"
    parameters:
      - name: "mode"
        type: "string"
        required: false
        default: "mixed"
        description: "Reset mode: soft, mixed, hard"
      - name: "paths"
        type: "array"
        required: false
        description: "Specific paths to reset"
    returns:
      type: "object"
      properties:
        reset_files:
          type: "array"
    errors:
      - code: "E_NOT_A_REPO"
    warning: "DESTRUCTIVE: hard reset discards changes permanently"

# Security Policies
security:
  sandbox: true
  audit_log: true
  protected_branches: ["main", "master", "production"]
  blocked_operations:
    - "push --force"  # Prevent force push
    - "reset --hard origin"  # Prevent destructive remote reset

# Safe Operations (No User Approval Needed)
safe_operations:
  - git_status
  - git_diff
  - git_log
  - git_branch (list only)

# Caution Operations (Warn User)
caution_operations:
  - git_reset (hard mode)
  - git_checkout (force)
  - git_branch (delete)

# Performance Guidelines
performance:
  git_status: { timeout_ms: 5000 }
  git_diff: { timeout_ms: 10000 }
  git_add: { timeout_ms: 10000 }
  git_commit: { timeout_ms: 15000 }
  git_checkout: { timeout_ms: 10000 }
  git_log: { timeout_ms: 10000 }
  git_branch: { timeout_ms: 5000 }
  git_reset: { timeout_ms: 10000 }

# Best Practices
best_practices:
  - "Always check git_status before committing"
  - "Review git_diff before staging changes"
  - "Use descriptive commit messages (50 char summary)"
  - "Follow conventional commits format (feat:, fix:, etc.)"
  - "Don't commit directly to protected branches"
  - "Create feature branches for new work"
  - "Stage related changes together"

# Conventional Commits
commit_message_format: |
  <type>(<scope>): <short description>

  <longer description>

  Types: feat, fix, docs, refactor, test, chore, perf, style
  Scope: optional component name
  Description: imperative mood, lowercase, no period

  Example:
  feat(auth): add JWT token validation

  Implement token validation middleware for API endpoints.
  Includes expiry checking and signature verification.

# Common Workflows
workflows:
  feature_branch:
    - git_checkout: { target: "feature/name", create: true }
    - "Make changes"
    - git_add: { paths: ["."] }
    - git_commit: { message: "feat: description" }

  commit_workflow:
    - git_status: {}
    - git_diff: {}
    - git_add: { paths: ["specific/files"] }
    - git_commit: { message: "type: description" }

  branch_cleanup:
    - git_checkout: { target: "main" }
    - git_branch: { action: "delete", name: "old-feature" }
