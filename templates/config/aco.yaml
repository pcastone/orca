# ACO (Agentic Coding Orchestrator) Configuration Template
# This file configures the ACO server and tool runtime
# Copy and customize for your deployment

aco:
  # Server Settings
  # WebSocket server for tool execution
  server:
    bind: "127.0.0.1:8080"  # Server bind address
    max_connections: 10  # Maximum concurrent WebSocket connections
    heartbeat_interval_ms: 30000  # Heartbeat every 30 seconds

    # TLS/SSL Configuration (optional)
    # tls:
    #   enabled: true
    #   cert_file: "/path/to/cert.pem"
    #   key_file: "/path/to/key.pem"

    # CORS Settings (if using web UI)
    # cors:
    #   enabled: true
    #   allowed_origins: ["http://localhost:3000"]

  # Tool Runtime Configuration
  # Controls how tools are executed
  runtime:
    # Workspace Path
    # All file operations are relative to this directory
    workspace: "/path/to/project"  # Change to your project root

    # Default Timeouts (milliseconds)
    timeouts:
      filesystem: 10000  # 10s for file operations
      git: 30000  # 30s for git operations
      shell: 600000  # 10m for shell commands (tests, builds)
      network: 15000  # 15s for network requests

    # Resource Limits
    limits:
      max_file_size: 10485760  # 10MB - maximum file read/write size
      max_output_size: 5242880  # 5MB - maximum tool output size
      max_concurrent_tools: 5  # Maximum parallel tool executions

      # Memory limits (optional)
      # max_memory_mb: 512  # Maximum memory per tool execution

    # Policy Enforcement
    # Security and safety controls
    policy:
      enable_sandbox: true  # Sandbox all tool executions
      enable_command_allowlist: true  # Only allow whitelisted shell commands
      enable_network_restrictions: true  # Restrict network access

      # Validation Rules
      # Each rule can be "blocking" (hard fail) or "warning" (log only)
      validators:
        - rule: "sec.paths.sandbox"
          enforcement: "blocking"  # Block path traversal attempts
          description: "Prevent access outside workspace"

        - rule: "sec.shell.allowlist"
          enforcement: "blocking"  # Block non-whitelisted commands
          description: "Only allow approved shell commands"

        - rule: "sec.network.allowlist"
          enforcement: "blocking"  # Block non-whitelisted domains
          description: "Restrict network access to approved domains"

        - rule: "build.must.pass"
          enforcement: "warning"  # Warn if build fails
          description: "Warn on build failures"

    # Shell Command Allowlist
    # Only these command patterns are allowed
    shell_allowlist:
      - "^cargo\\s"  # Rust build commands
      - "^rustc\\s"  # Rust compiler
      - "^npm\\s"  # Node package manager
      - "^yarn\\s"  # Yarn package manager
      - "^git\\s"  # Git commands
      - "^rg\\s"  # Ripgrep
      - "^grep\\s"  # Grep
      - "^find\\s"  # Find
      - "^ls\\s"  # List files
      - "^cat\\s"  # Read files
      - "^python3?\\s"  # Python
      - "^node\\s"  # Node.js

    # Network Allowlist
    # Only these domains are accessible
    network_allowlist:
      - "crates.io"  # Rust package registry
      - "docs.rs"  # Rust documentation
      - "github.com"  # GitHub
      - "gitlab.com"  # GitLab
      - "npmjs.com"  # NPM registry
      - "pypi.org"  # Python package index

  # Authentication Configuration (optional)
  # auth:
  #   enabled: true
  #   method: "token"  # Options: "token", "jwt"
  #
  #   # Token-based auth
  #   tokens:
  #     - token: "${ACO_AUTH_TOKEN}"
  #       name: "orchestrator"
  #       permissions: ["all"]
  #
  #   # JWT-based auth
  #   # jwt:
  #   #   secret: "${JWT_SECRET}"
  #   #   issuer: "aco"
  #   #   audience: "orchestrator"

  # Database Configuration
  # SQLite database for session and audit logging
  database:
    path: "~/.aco/aco.db"  # Database file location
    max_connections: 5  # Connection pool size
    auto_migrate: true  # Run migrations on startup

  # Logging Configuration
  logging:
    level: "info"  # Options: "trace", "debug", "info", "warn", "error"
    format: "pretty"  # Options: "json", "pretty"
    output: "stdout"  # Options: "stdout", "file"

    # Optional: File logging
    # file_path: "~/.aco/logs/aco.log"
    # max_file_size_mb: 50
    # max_files: 5

    # Audit logging for security-sensitive operations
    audit:
      enabled: true
      log_file: "~/.aco/logs/audit.log"
      events:
        - "shell_exec"  # Log all shell executions
        - "file_write"  # Log file writes
        - "file_delete"  # Log file deletions
        - "network_request"  # Log network requests
        - "auth_failure"  # Log authentication failures

  # Performance Tuning
  performance:
    # WebSocket settings
    websocket:
      buffer_size: 65536  # 64KB buffer
      max_message_size: 10485760  # 10MB max message

    # Tool execution
    tool_executor:
      worker_threads: 4  # Number of worker threads
      queue_size: 100  # Execution queue capacity

  # Feature Flags
  features:
    enable_tui: true  # Enable terminal UI
    enable_web_ui: false  # Enable web UI (if available)
    enable_git_integration: true  # Enable git operations
    enable_file_watch: false  # Watch files for changes
    enable_metrics: true  # Collect performance metrics

  # Git Integration Settings
  git:
    auto_detect: true  # Auto-detect git repository
    commit_signing: false  # Sign commits (requires GPG setup)
    default_branch: "main"  # Default branch name

    # Commit message template
    commit_template: |
      {type}: {description}

      {details}

# Environment-specific overrides

# development:
#   aco:
#     server:
#       bind: "127.0.0.1:8080"
#     runtime:
#       policy:
#         enable_sandbox: false  # Disable sandbox in dev
#     logging:
#       level: "debug"
#     features:
#       enable_tui: true

# production:
#   aco:
#     server:
#       bind: "0.0.0.0:8080"
#       tls:
#         enabled: true
#         cert_file: "/etc/aco/cert.pem"
#         key_file: "/etc/aco/key.pem"
#     auth:
#       enabled: true
#     runtime:
#       policy:
#         enable_sandbox: true
#     logging:
#       level: "warn"
#       format: "json"
#       output: "file"
#       file_path: "/var/log/aco/aco.log"
#     database:
#       path: "/var/lib/aco/aco.db"
