# Task Plan Test Cases
# Test cases for validating task plan generation and structure

test_cases:
  # Simple Tasks
  - name: "simple_file_read"
    category: "basic"
    input_query: "Read the README.md file"
    expected_tasks: 1
    expected_actions:
      - "read_file"
    validates:
      - "plan_structure"
      - "task_count"
      - "action_types"
    expected_plan:
      plan_id: "read-readme-*"
      goal: "Read and display README.md"
      tasks:
        - id: 1
          action: "read_file"
          target: "README.md"
          depends_on: []

  - name: "code_search"
    category: "basic"
    input_query: "Find all println! statements"
    expected_tasks: 1-2
    expected_actions:
      - "grep"
    validates:
      - "plan_structure"
      - "action_types"
    expected_plan:
      goal: "Search for println! statements in code"
      tasks:
        - id: 1
          action: "grep"
          params:
            pattern: "println!"

  # Debugging Workflows
  - name: "debug_test_failure"
    category: "debugging"
    input_query: "Fix the failing test_auth test"
    expected_tasks: 5-7
    expected_actions:
      - "read_file"
      - "run_test"
      - "analyze_error"
      - "edit_file"
      - "run_test"
    validates:
      - "plan_structure"
      - "dependencies"
      - "task_sequence"
      - "verification_steps"
    expected_plan:
      goal: "Identify and fix test_auth failure"
      tasks:
        - id: 1
          action: "read_file"
        - id: 2
          action: "run_test"
          depends_on: [1]
        - id: 3
          action: "analyze_error"
          depends_on: [2]

  - name: "build_error"
    category: "debugging"
    input_query: "Fix compilation errors"
    expected_tasks: 4-6
    expected_actions:
      - "run_build"
      - "analyze_error"
      - "read_file"
      - "edit_file"
      - "run_build"
    validates:
      - "plan_structure"
      - "iterative_approach"
      - "verification"

  # Git Workflows
  - name: "git_commit"
    category: "git"
    input_query: "Commit changes with message 'fix: bug'"
    expected_tasks: 3-5
    expected_actions:
      - "git_status"
      - "git_diff"
      - "git_add"
      - "git_commit"
    validates:
      - "plan_structure"
      - "git_workflow"
      - "params_present"
    expected_plan:
      tasks:
        - id: 4
          action: "git_commit"
          params:
            message: "fix: bug"

  - name: "create_branch"
    category: "git"
    input_query: "Create feature branch for new API"
    expected_tasks: 2-3
    expected_actions:
      - "git_status"
      - "git_checkout"
    validates:
      - "plan_structure"
      - "branch_naming"

  # Complex Workflows
  - name: "add_feature"
    category: "modification"
    input_query: "Add authentication to the API"
    expected_tasks: 8-12
    expected_actions:
      - "read_file"
      - "search_code"
      - "write_file"
      - "edit_file"
      - "run_test"
      - "run_build"
    validates:
      - "plan_structure"
      - "dependencies"
      - "comprehensive_approach"
      - "verification_steps"

  - name: "refactoring"
    category: "modification"
    input_query: "Refactor the parse_config function"
    expected_tasks: 5-8
    expected_actions:
      - "read_file"
      - "grep"  # find callers
      - "edit_file"
      - "run_test"
    validates:
      - "plan_structure"
      - "caller_analysis"
      - "test_verification"

# Validation Rules
validation_rules:
  plan_structure:
    - "Must have plan_id, query, goal, and tasks fields"
    - "plan_id must be unique and descriptive"
    - "goal must clearly state objective"
    - "tasks must be array with at least 1 task"

  task_structure:
    - "Each task must have id, action, and reason"
    - "Task IDs must be sequential starting from 1"
    - "depends_on can only reference earlier task IDs"
    - "Actions must be from allowed_actions list"

  dependencies:
    - "No forward dependencies (task N cannot depend on task N+1)"
    - "No circular dependencies"
    - "Task 1 cannot have dependencies"
    - "Dependencies must form valid DAG"

  git_workflow:
    - "git_commit must have params.message"
    - "git_add should come before git_commit"
    - "git_status often first step"

  verification_steps:
    - "run_test or run_build should verify changes"
    - "Verification should be last or near-last step"
    - "Failing verification should be handled"

# Test Execution
test_execution:
  generate_plan:
    - "Send input_query to Planning LLM"
    - "Parse returned JSON plan"
    - "Validate plan structure"

  validate_plan:
    - "Check required fields present"
    - "Verify task count in expected range"
    - "Confirm expected actions present"
    - "Validate dependencies"
    - "Check for validation rule violations"

  scoring:
    - "plan_structure_valid: 25 points"
    - "task_count_appropriate: 15 points"
    - "actions_correct: 20 points"
    - "dependencies_valid: 20 points"
    - "has_verification: 10 points"
    - "clear_reasoning: 10 points"
    - "Total: 100 points"

# Pass/Fail Criteria
pass_criteria:
  minimum_score: 70
  required_validations:
    - "plan_structure"
    - "task_structure"
  critical_failures:
    - "Invalid JSON"
    - "Forward dependencies"
    - "Missing required fields"

# Test Coverage Targets
coverage_targets:
  basic_operations: 90%  # Simple file ops, searches
  debugging_workflows: 80%  # Test/build debugging
  git_workflows: 85%  # Git operations
  modification_workflows: 75%  # Complex changes
  overall: 80%
