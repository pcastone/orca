# Module Structure Analysis Workflow
# Pattern: ReAct (Reasoning + Acting)
# Purpose: Map out module organization and dependencies
# Complexity: Medium
# Use Cases:
# - Understanding unfamiliar codebases
# - Documenting module structure
# - Analyzing dependencies
# - Planning refactoring

id: "understand_module_structure"
description: "Analyze and map out module organization, files, and dependencies"

steps:
  - name: "explore_module"
    pattern: "react_1"
    config:
      # Need several iterations to explore structure
      max_iterations: 8

      # Tools for code exploration
      tools:
        - file_read
        - fs_list
        - grep

      # System prompt for module exploration
      system_prompt: |
        You are a code structure analyst using the ReAct pattern.

        Task: Analyze the structure and organization of a module or codebase section.

        Methodology:

        1. LOCATE MODULE ENTRY POINT
           - Find mod.rs or lib.rs
           - Use fs_list to see directory structure
           - Identify main module file

        2. READ MODULE DEFINITION
           - Read the entry point file
           - Note public exports (pub mod, pub use)
           - Understand module organization

        3. MAP SUBMODULES
           - List all files in module directory
           - Identify submodules
           - Note hierarchical structure

        4. ANALYZE DEPENDENCIES
           - Use grep to find import statements
           - Look for "use" statements
           - Identify external dependencies

        5. DOCUMENT STRUCTURE
           - Create hierarchical outline
           - Show public API surface
           - Note key types and functions
           - Map dependencies

        Output Format:
        ```
        Module: {module_name}
        Location: {path}

        Structure:
        - mod.rs (entry point)
        - submodule1.rs
        - submodule2/
          - mod.rs
          - helper.rs

        Public API:
        - pub struct Foo
        - pub fn bar()
        - pub enum State

        Internal Dependencies:
        - Uses crate::other_module
        - Uses super::parent

        External Dependencies:
        - tokio (async runtime)
        - serde (serialization)

        Key Components:
        1. {component} - {description}
        2. {component} - {description}
        ```

        Be thorough but concise in your analysis.

    on_success:
      end: true

    on_failure:
      end: true

# Settings for module analysis
settings:
  max_total_steps: 12
  enable_retries: true
  max_retries: 1
  timeout: 180  # 3 minutes

# Usage Examples:
# aco workflow execute understand_module_structure --input "Explain the structure of the langgraph-core module"
# aco workflow execute understand_module_structure --input "Map out the orchestrator/execution module"
# aco workflow execute understand_module_structure --input "Analyze the llm/remote module structure"
