# Reflection Pattern Example
# This workflow demonstrates self-critique and iterative improvement
#
# Task: Write a summary and improve it through self-critique
# Pattern: Reflection (Generate → Critique → Refine)
# Complexity: Advanced
#
# This example shows:
# - How reflection pattern works
# - Generator vs critic LLM roles
# - Quality assessment and iteration
# - Quality threshold usage

id: "write_with_reflection"
description: "Learn Reflection pattern by writing and improving documentation"

steps:
  - name: "write_and_improve"
    pattern: "reflection_1"
    config:
      # Maximum critique-refine iterations
      max_iterations: 3

      # Quality score threshold (0.0-1.0)
      # Stop iterating when this score is reached
      quality_threshold: 0.85

      # Generator LLM: creates and refines content
      generator_config:
        model: "gpt-4"
        temperature: 0.6  # Balanced creativity

      # Critic LLM: evaluates quality
      critic_config:
        model: "gpt-4"
        temperature: 0.3  # More deterministic for evaluation

      # Tools for reading and writing
      tools:
        - file_read
        - file_write

      # System prompt guides both generation and critique
      system_prompt: |
        You are a documentation writer using the Reflection pattern.

        GENERATOR MODE:
        Write clear, comprehensive documentation:
        - Read relevant code to understand it
        - Write explanation in markdown
        - Include examples where helpful
        - Use clear, accessible language

        CRITIC MODE:
        Critique your own writing on:

        1. CLARITY (weight: 30%)
           - Is it easy to understand?
           - Are terms well explained?
           - Is structure logical?

        2. COMPLETENESS (weight: 30%)
           - Are all key points covered?
           - Are examples sufficient?
           - Is context provided?

        3. ACCURACY (weight: 25%)
           - Is information correct?
           - Are code examples accurate?
           - Are assumptions valid?

        4. STYLE (weight: 15%)
           - Is it well formatted?
           - Is tone appropriate?
           - Is it concise?

        Provide:
        - Quality score: 0.0-1.0 (weighted average)
        - Specific issues found
        - Suggestions for improvement

        REFINEMENT MODE:
        Improve based on critique:
        - Address identified issues
        - Clarify unclear sections
        - Add missing information
        - Fix inaccuracies

        Continue until quality_threshold (0.85) is met.

    on_success:
      end: true

    on_failure:
      end: true

settings:
  max_total_steps: 8
  enable_retries: true
  max_retries: 1
  timeout: 600  # 10 minutes for quality work

# Usage Example:
# aco workflow execute write_with_reflection \
#   --input "Write documentation for the StateGraph builder in langgraph-core"
