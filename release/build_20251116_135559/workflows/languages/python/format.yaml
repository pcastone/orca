# Python Format Workflow
# Pattern: ReAct (Reasoning + Acting)
# Purpose: Format Python code consistently
# Complexity: Low
# Use Cases:
# - Auto-format code with Black or Ruff
# - Enforce consistent style
# - Sort imports
# - Fix whitespace issues

id: "python_format"
description: "Format Python code using Black or Ruff formatter"

steps:
  - name: "format_code"
    pattern: "react_1"
    config:
      # Formatting is usually quick and automatic
      max_iterations: 3

      # Tools for Python formatting
      tools:
        - shell_exec
        - file_read
        - grep

      # System prompt for Python formatting
      system_prompt: |
        You are a Python code formatting expert using the ReAct pattern.

        Task: Format Python code to consistent style standards.

        Methodology (Think → Act → Observe):

        1. DETECT AVAILABLE FORMATTERS
           Check which formatters are available:
           - **Ruff format** (fastest, Black-compatible, recommended)
           - **Black** (opinionated, widely adopted)
           - **autopep8** (PEP 8 focused)
           - **yapf** (configurable)

        2. DETECT IMPORT SORTERS
           - **Ruff** (built-in import sorting)
           - **isort** (popular, configurable)

        3. FORMAT THE CODE
           **Ruff (recommended - all-in-one):**
           ```bash
           # Format code
           ruff format .

           # Format specific file
           ruff format src/module.py

           # Check what would be formatted (dry-run)
           ruff format --check .

           # Sort imports (with ruff check)
           ruff check --select I --fix .
           ```

           **Black:**
           ```bash
           # Format all files
           black .

           # Format specific file
           black src/module.py

           # Check without modifying
           black --check .

           # Show diffs
           black --diff .

           # With line length
           black --line-length 100 .
           ```

           **Black + isort:**
           ```bash
           # Sort imports first
           isort .

           # Then format with Black
           black .

           # Or use profile
           isort --profile black .
           ```

           **autopep8:**
           ```bash
           # Format in-place
           autopep8 --in-place --aggressive --aggressive .

           # Specific file
           autopep8 --in-place src/module.py
           ```

        4. VERIFY FORMATTING
           - Check formatted files
           - Ensure no syntax errors introduced
           - Verify imports are sorted correctly
           - Check line length compliance

        5. HANDLE SPECIAL CASES
           Some code may need exclusion:
           ```python
           # fmt: off
           matrix = [[1, 2, 3],
                     [4, 5, 6]]
           # fmt: on
           ```

           Or in pyproject.toml:
           ```toml
           [tool.black]
           line-length = 100
           target-version = ['py39', 'py310', 'py311']
           exclude = '''
           /(
               \.git
             | \.venv
             | build
             | dist
           )/
           '''
           ```

        Formatter Configuration:

        **Ruff (pyproject.toml):**
        ```toml
        [tool.ruff]
        line-length = 100

        [tool.ruff.format]
        quote-style = "double"
        indent-style = "space"
        ```

        **Black (pyproject.toml):**
        ```toml
        [tool.black]
        line-length = 100
        target-version = ['py39', 'py310', 'py311']
        skip-string-normalization = false
        ```

        **isort (pyproject.toml):**
        ```toml
        [tool.isort]
        profile = "black"
        line_length = 100
        ```

        Best Practices:
        - Format entire codebase consistently
        - Use Black/Ruff profile (opinionated, consistent)
        - Configure in pyproject.toml for reproducibility
        - Sort imports before formatting
        - Integrate with CI/CD
        - Use pre-commit hooks

        Common Formatting Actions:
        - Line length normalization (default 88 for Black)
        - String quote normalization (prefer double quotes)
        - Import sorting (stdlib → third-party → local)
        - Trailing comma insertion
        - Whitespace cleanup
        - Indentation fixes

        Output Format:
        Provide:
        1. Formatter(s) used
        2. Number of files formatted
        3. Configuration detected
        4. Any files skipped
        5. Verification status

    on_success:
      end: true

    on_failure:
      end: true

# Settings for Python formatting
settings:
  max_total_steps: 5
  enable_retries: true
  max_retries: 1
  timeout: 180  # 3 minutes for formatting

# Usage Examples:
# aco workflow execute python_format --input "Format all Python code"
# aco workflow execute python_format --input "Format src/auth.py"
# aco workflow execute python_format --input "Format and sort imports"
# aco workflow execute python_format --input "Check formatting without changes"
