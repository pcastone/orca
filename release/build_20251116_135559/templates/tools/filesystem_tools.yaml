# Filesystem Tools Catalog
# Comprehensive catalog of all filesystem operation tools

category: "filesystem"
description: "Tools for file and directory operations"

tools:
  # File Reading
  - name: "file_read"
    description: "Read contents of a file"
    parameters:
      - name: "path"
        type: "string"
        required: true
        description: "Path to file relative to workspace"
      - name: "max_bytes"
        type: "integer"
        required: false
        default: 1048576  # 10MB
        description: "Maximum bytes to read"
    returns:
      type: "object"
      properties:
        content:
          type: "string"
          description: "File contents"
        sha256:
          type: "string"
          description: "SHA256 hash of content"
        size:
          type: "integer"
          description: "File size in bytes"
    errors:
      - code: "E_FILE_NOT_FOUND"
      - code: "E_PERMISSION_DENIED"
      - code: "E_FILE_TOO_LARGE"
    example:
      input: { path: "src/main.rs" }
      output: { content: "fn main() {...}", sha256: "abc123...", size: 256 }

  # File Writing
  - name: "file_write"
    description: "Write or create a file"
    parameters:
      - name: "path"
        type: "string"
        required: true
        description: "Path to file"
      - name: "content"
        type: "string"
        required: true
        description: "Content to write"
      - name: "create_dirs"
        type: "boolean"
        required: false
        default: true
        description: "Create parent directories if needed"
    returns:
      type: "object"
      properties:
        bytes_written:
          type: "integer"
        path:
          type: "string"
    errors:
      - code: "E_PERMISSION_DENIED"
      - code: "E_DISK_FULL"
      - code: "E_PATH_INVALID"
    example:
      input: { path: "config.toml", content: "[settings]\nkey = \"value\"" }
      output: { bytes_written: 28, path: "config.toml" }

  # File Patching
  - name: "file_patch"
    description: "Apply a unified diff patch to a file"
    parameters:
      - name: "path"
        type: "string"
        required: true
        description: "Path to file to patch"
      - name: "unified_diff"
        type: "string"
        required: true
        description: "Unified diff format patch"
    returns:
      type: "object"
      properties:
        lines_added:
          type: "integer"
        lines_removed:
          type: "integer"
        hunks_applied:
          type: "integer"
    errors:
      - code: "E_FILE_NOT_FOUND"
      - code: "E_PATCH_FAILED"
      - code: "E_INVALID_DIFF"
    example:
      input:
        path: "src/main.rs"
        unified_diff: |
          --- a/src/main.rs
          +++ b/src/main.rs
          @@ -1,3 +1,4 @@
           fn main() {
          +    println!("Hello");
               run();
           }

  # Directory Listing
  - name: "fs_list"
    description: "List files in a directory"
    parameters:
      - name: "glob"
        type: "string"
        required: true
        description: "Glob pattern (e.g., 'src/**/*.rs')"
      - name: "max_results"
        type: "integer"
        required: false
        default: 5000
        description: "Maximum number of results"
      - name: "include_hidden"
        type: "boolean"
        required: false
        default: false
        description: "Include hidden files (.files)"
    returns:
      type: "object"
      properties:
        files:
          type: "array"
          items:
            type: "object"
            properties:
              path:
                type: "string"
              size:
                type: "integer"
              modified:
                type: "integer"
        count:
          type: "integer"
    errors:
      - code: "E_PATH_NOT_FOUND"
      - code: "E_TOO_MANY_RESULTS"
    example:
      input: { glob: "src/**/*.rs", max_results: 100 }
      output: { files: [{path: "src/main.rs", size: 1024, modified: 1705334400}], count: 1 }

  # Content Search
  - name: "grep"
    description: "Search file contents with regex"
    parameters:
      - name: "pattern"
        type: "string"
        required: true
        description: "Regular expression pattern"
      - name: "glob"
        type: "string"
        required: false
        default: "**/*"
        description: "Glob pattern for files to search"
      - name: "case_sensitive"
        type: "boolean"
        required: false
        default: true
        description: "Case-sensitive matching"
      - name: "max_results"
        type: "integer"
        required: false
        default: 1000
        description: "Maximum number of matches"
    returns:
      type: "object"
      properties:
        matches:
          type: "array"
          items:
            type: "object"
            properties:
              file:
                type: "string"
              line:
                type: "integer"
              content:
                type: "string"
        count:
          type: "integer"
    errors:
      - code: "E_INVALID_REGEX"
      - code: "E_TOO_MANY_RESULTS"
    example:
      input: { pattern: "fn main", glob: "src/**/*.rs" }
      output: { matches: [{file: "src/main.rs", line: 1, content: "fn main() {"}], count: 1 }

  # File Copy
  - name: "fs_copy"
    description: "Copy a file or directory"
    parameters:
      - name: "source"
        type: "string"
        required: true
        description: "Source path"
      - name: "destination"
        type: "string"
        required: true
        description: "Destination path"
      - name: "overwrite"
        type: "boolean"
        required: false
        default: false
        description: "Overwrite if exists"
    returns:
      type: "object"
      properties:
        bytes_copied:
          type: "integer"
        files_copied:
          type: "integer"
    errors:
      - code: "E_SOURCE_NOT_FOUND"
      - code: "E_DESTINATION_EXISTS"
      - code: "E_PERMISSION_DENIED"

  # File Move/Rename
  - name: "fs_move"
    description: "Move or rename a file or directory"
    parameters:
      - name: "source"
        type: "string"
        required: true
        description: "Source path"
      - name: "destination"
        type: "string"
        required: true
        description: "Destination path"
    returns:
      type: "object"
      properties:
        old_path:
          type: "string"
        new_path:
          type: "string"
    errors:
      - code: "E_SOURCE_NOT_FOUND"
      - code: "E_DESTINATION_EXISTS"
      - code: "E_CROSS_DEVICE"

  # File Delete
  - name: "fs_delete"
    description: "Delete a file or directory"
    parameters:
      - name: "path"
        type: "string"
        required: true
        description: "Path to delete"
      - name: "recursive"
        type: "boolean"
        required: false
        default: false
        description: "Delete directories recursively"
    returns:
      type: "object"
      properties:
        deleted:
          type: "boolean"
        items_deleted:
          type: "integer"
    errors:
      - code: "E_NOT_FOUND"
      - code: "E_NOT_EMPTY"
      - code: "E_PERMISSION_DENIED"

# Security Policies
security:
  sandbox: true
  allowed_extensions: [".rs", ".toml", ".yaml", ".yml", ".json", ".md", ".txt", ".sh", ".py", ".js", ".ts"]
  blocked_paths: [".git/config", "*.key", "*.pem", ".env"]
  max_file_size: 10485760  # 10MB
  max_results: 5000

# Performance Guidelines
performance:
  file_read: { timeout_ms: 10000, max_concurrent: 5 }
  file_write: { timeout_ms: 10000, max_concurrent: 3 }
  file_patch: { timeout_ms: 5000, max_concurrent: 3 }
  fs_list: { timeout_ms: 15000, max_concurrent: 2 }
  grep: { timeout_ms: 30000, max_concurrent: 2 }
  fs_copy: { timeout_ms: 30000, max_concurrent: 2 }
  fs_move: { timeout_ms: 10000, max_concurrent: 3 }
  fs_delete: { timeout_ms: 10000, max_concurrent: 2 }

# Best Practices
best_practices:
  - "Always use file_read before file_write or file_patch"
  - "Use grep to find files, then file_read to examine them"
  - "Prefer file_patch over file_write for modifications"
  - "Use fs_list with specific globs to limit results"
  - "Check file sizes before reading large files"
  - "Use case-insensitive grep when searching for patterns"

# Common Patterns
patterns:
  read_modify_write:
    - "file_read to get current content"
    - "Modify content in memory"
    - "file_write to save changes"

  search_and_edit:
    - "grep to find files with pattern"
    - "file_read to examine matches"
    - "file_patch to apply fixes"

  safe_delete:
    - "file_read to verify file contents"
    - "Confirm deletion is intentional"
    - "fs_delete to remove file"
