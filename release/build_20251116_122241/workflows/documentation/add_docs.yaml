# Add Documentation Workflow
# Pattern: Reflection (Generate → Critique → Refine for quality docs)
# Purpose: Create high-quality documentation
# Complexity: Low-Medium
# Use Cases:
# - Document functions and modules
# - Write API documentation
# - Create README files
# - Add code comments

id: "add_documentation"
description: "Create high-quality documentation with self-review and refinement"

steps:
  - name: "generate_docs"
    pattern: "reflection_1"
    config:
      # 2-3 iterations for quality docs
      max_iterations: 3

      # Moderate quality threshold for documentation
      quality_threshold: 0.80

      # Generator configuration
      generator_config:
        temperature: 0.6
        system_prompt: |
          You are a technical documentation expert.

          Task: Create clear, comprehensive documentation.

          Documentation Guidelines:
          1. Start with a brief overview
          2. Explain purpose and use cases
          3. Provide usage examples
          4. Document parameters and return values
          5. Note any edge cases or limitations
          6. Include error handling information

          For Rust Code Documentation:
          - Use /// for public items
          - Use //! for module-level docs
          - Include # Examples sections
          - Document # Errors and # Panics
          - Add # Safety for unsafe code

          Output Format (Rust):
          ```rust
          /// Brief description of the function.
          ///
          /// Longer explanation of what the function does,
          /// when to use it, and any important details.
          ///
          /// # Arguments
          ///
          /// * `param1` - Description of param1
          /// * `param2` - Description of param2
          ///
          /// # Returns
          ///
          /// Description of return value
          ///
          /// # Errors
          ///
          /// When this function returns an error
          ///
          /// # Examples
          ///
          /// ```
          /// use crate::module::function;
          ///
          /// let result = function(arg1, arg2)?;
          /// ```
          pub fn function(param1: Type1, param2: Type2) -> Result<ReturnType> {
              // ...
          }
          ```

      # Critic configuration
      critic_config:
        temperature: 0.3
        system_prompt: |
          Review the documentation for quality.

          Assessment Criteria:
          1. Clarity - Easy to understand?
          2. Completeness - All aspects covered?
          3. Examples - Good usage examples?
          4. Accuracy - Technically correct?
          5. Format - Follows conventions?
          6. Helpfulness - Useful for users?

          Provide:
          - Quality score (0.0-1.0)
          - What's good
          - What needs improvement
          - Specific suggestions

      # Tools for documentation
      tools:
        - file_read
        - file_patch

    on_success:
      end: true

    on_failure: "simple_docs"

  # Fallback: If reflection fails, use simple approach
  - name: "simple_docs"
    pattern: "react_1"
    config:
      max_iterations: 3
      tools:
        - file_read
        - file_patch

      system_prompt: |
        Create basic documentation without iteration.

        1. Read the code to be documented
        2. Write clear, simple documentation
        3. Include basic examples
        4. Apply documentation

        Keep it simple and clear.

    on_success:
      end: true

    on_failure:
      end: true

# Settings for documentation
settings:
  max_total_steps: 10
  enable_retries: true
  max_retries: 1
  timeout: 300  # 5 minutes

# Usage Examples:
# aco workflow execute add_documentation --input "Document the authenticate_user function"
# aco workflow execute add_documentation --input "Add rustdoc comments to the StateGraph module"
# aco workflow execute add_documentation --input "Write documentation for the LLM provider trait"
# aco workflow execute add_documentation --input "Create API docs for the task execution system"
